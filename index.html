<!DOCTYPE html>
<html>
<head>
	<title></title>
	<style type="text/css">
		.box {
			width: 100px;
			height: 100px;
			border: 1px solid black;
			margin: 10px;
			float: left;
		}

		.boxContainer {
			float: left;
		}

		#input {
			clear: both;
		}

		button {
			margin: 10px;
			
		}

		input {
			margin: 10px;
		}
	</style>
	<script src="https://code.jquery.com/jquery-3.4.0.js" integrity="sha256-DYZMCC8HTC+QDr5QNaIcfR7VSPtcISykd+6eSmBW5qo="
	    crossorigin="anonymous"></script>
</head>
<body>
	<div class='boxContainer'></div>
	<div class='container'>
		<p>1. Select Color For New Box:
			<input type="color" id="selectNewBoxColor">
			
		</p>
		<p>2. Add New Box(es):
			<button id='addNewBox'>Add New Box</button>
		</p>
		<p>
			3. Select New Color:
			<input type="color" id="changeColorsTo">
			<button id='updateColor'>Update All Colors To Selected Color</button>
			</div>
		</p>
		

<script type="text/javascript">

var colorSelector;
var newBoxColor;

$('#selectNewBoxColor').on('change',function(){
	newBoxColor = $('#selectNewBoxColor').val();
});

$('#changeColorsTo').on('change',function(){
	colorSelector = hexToRgb($(this).val());
});

$('#addNewBox').on('click', function(){
	if (newBoxColor === undefined){
		newBoxColor = '#ffffff';
	}
	var newBox = $('<div class="box">');
	newBox.css('background-color', newBoxColor);
	$('body').append(newBox);

})

// takes input values and starts change color function
$('#updateColor').on('click', function(){

	if (colorSelector === undefined){
		colorSelector = {r: 0, g: 0, b: 0};
	}

	var endObj = colorSelector;
	var endR = endObj.r;
	var endG = endObj.g;
	var endB = endObj.b;

	var currentBoxes = captureBackgroundRGBs().slice();
	var rGradients = [];
	var gGradients = [];
	var bGradients = [];
	var maxArr = [];


	for (var j=0; j<currentBoxes.length; j++) {


		rGradients.push(towardNum(currentBoxes[j].r, endR).slice());
		gGradients.push(towardNum(currentBoxes[j].g, endG).slice());
		bGradients.push(towardNum(currentBoxes[j].b, endB).slice());
		
		maxArr.push(Math.max(rGradients[j].length, gGradients[j].length, bGradients[j].length));

		changeColor(j, 0, currentBoxes[j]);

		function changeColor(itemIndex, i, currentBoxColor) {
			var currentR = rGradients[itemIndex][i];
			var currentG = gGradients[itemIndex][i];
			var currentB = bGradients[itemIndex][i];

			displayBgColor(itemIndex, currentBoxColor);
			currentBoxColor.r = currentR;
			currentBoxColor.g = currentG;
			currentBoxColor.b = currentB;

			if (i == maxArr[itemIndex]-1) {
				i = 0;
				return;
			} else {
				if (currentR === endR){
					rGradients[itemIndex].push(endR);
				}
				if (currentG === endG){
					gGradients[itemIndex].push(endG);
				}
				if (currentB === endB){
					bGradients[itemIndex].push(endB);
				}
				i++;
			}
			
			setTimeout(changeColor, 10, itemIndex, i, currentBoxColor);
		}
	}
});

// takes in element name and returns array with those element ids
function getAllElements(element) {
	var arr = [];
	$('.box').each(function(i, element) {
		arr.push(i);
	});
	return arr;
}
// {r: 0, g: 0, b: 0}
// displays background color
function displayBgColor(id, rgbObj) {
	// console.log('Set bg color of ' + id + ' to:', 'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')');
	$('.box:eq('+ id +')').css('background-color', 'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')');
}

// increment/decrement from start num to end num and store in array
function towardNum(start, end) {
	var start = start;
	var end = end;
	var arr = [];

	if (start < end) {
		for (var i=start; i <= end; i++) {
			arr.push(i);
		}
	} else if (start > end) {
		for (var i=start; i >= end; i--) {
			arr.push(i);
		}
	} else {
		arr.push(start);
	}
	return arr;
}


// returns background colors of all boxes in an array of rgb objects
function captureBackgroundRGBs() {
	var arr = [];
	var specificDiv;
	var divs = document.querySelectorAll('.box');
	var rgb;

	for (var j=0; j<divs.length; j++){
		specificDiv = getComputedStyle(divs[j]);
		rgb = specificDiv.backgroundColor;
		arr.push(rgbToObject(rgb));
	}
	return arr;
}

// takes a string of "rgb(x,y,z)" & returns it as an RGB object
function rgbToObject(str) {

	var newStr;
	var tempArr = [];
	var obj = {};

	newStr = str.substring(str.indexOf('(')+1,str.indexOf(')'));
	tempArr = newStr.split(',').slice();
	for (var j in tempArr){
		tempArr.push(parseInt(tempArr[j].trim()));
	}

	obj['r'] = tempArr[3];
	obj['g'] = tempArr[4];
	obj['b'] = tempArr[5];

	return obj;
}

// hex to rgb object
function hexToRgb(hex) {
    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
    } : null;
}



</script>

</body>
</html>