<!DOCTYPE html>
<html>
<head>
	<title></title>
	<style type="text/css">
		.d {
			width: 100px;
			height: 100px;
			border: 1px solid black;
			background-color: rgb(0,255,0);
			margin: 10px;
			float: left;
		}

		#input {
			clear: both;
		}

		button {
			margin: 10px;
			
		}

		input {
			margin: 10px;
		}


	</style>
	<script src="https://code.jquery.com/jquery-3.4.0.js" integrity="sha256-DYZMCC8HTC+QDr5QNaIcfR7VSPtcISykd+6eSmBW5qo="
	    crossorigin="anonymous"></script>
</head>
<body>
	<div id='container'>
		<div class='d'></div>
	</div>
	
	<div id='input'>
		<button id='colorButton'>New Color</button>
		<input type="color" id="color">
	</div>
	
	<button id='new'>Add New Box</button>



<script type="text/javascript">

var colorSelector;

$('#color').on('change',function(){
	colorSelector = hexToRgb($('#color').val());
	console.log('color changed to:', colorSelector);
});

$('#new').on('click', function(){
	var newDiv = $('<div>');
	newDiv.addClass('d');
	$('#container').append(newDiv);

})

// takes input values and starts change color function
$('#colorButton').on('click', function(){
	if (colorSelector === undefined){
		colorSelector = {r: 0, g: 0, b: 0};
	}

	var endObj = colorSelector;
	var endR = endObj.r;
	var endG = endObj.g;
	var endB = endObj.b;
	var startObj;
	var indexArr = [];
	for (i in getAllElements('div')) {
		indexArr.push(0);
	}


	for (j in indexArr) {

		var startObj = captureBackgroundRGBs()[j];
		var r = towardNum(startObj.r, endR).slice();
		var g = towardNum(startObj.g, endG).slice();
		var b = towardNum(startObj.b, endB).slice();
		var maxArr = Math.max(r.length, g.length, b.length);

		changeColor(j, startObj, endObj);

		function changeColor(i, startColorObj, endColorObj) {
			console.log(indexArr[i])
			displayBgColor(i, r[indexArr[i]], g[indexArr[i]], b[indexArr[i]]);
			
			if (indexArr[i] == maxArr-1) {
				indexArr[i] = 0;
				return;
			} else {
				if (r[indexArr[i]] === endR){
					r.push(endR);
				}
				if (g[indexArr[i]] === endG){
					g.push(endG);
				}
				if (b[indexArr[i]] === endB){
					b.push(endB);
				}
				indexArr[i]++;
			}
			
			setTimeout(changeColor, 10, i, r[indexArr[i]], g[indexArr[i]], b[indexArr[i]]);
		}
	}
});

// takes in element name and returns array with those element ids
function getAllElements(element) {
	var arr = [];
	$('.d').each(function(i, element) {
		arr.push(i);
	});
	return arr;
}

// displays background color
function displayBgColor(id, r, g, b) {
	$('.d:eq('+ id +')').css('background-color', 'rgb(' + r + ',' + g + ',' + b + ')');
}

// stores numbers up to or down to end, from start
function towardNum(start, end) {
	var start = start;
	var end = end;
	var arr = [];

	if (start < end) {
		for (var i=start; i <= end; i++) {
			arr.push(i);
		}
	} else if (start > end) {
		for (var i=start; i >= end; i--) {
			arr.push(i);
		}
	} else {
		arr.push(start);
	}
	return arr;
}


// returns all background color in an array of rgb objects
function captureBackgroundRGBs() {
	var arr = [];
	var specificDiv;
	var divs = document.querySelectorAll('.d');
	var rgb;

	for (var j=0; j<divs.length; j++){
		specificDiv = getComputedStyle(divs[j]);
		rgb = specificDiv.backgroundColor;
		arr.push(rgbToObject(rgb));
	}

	return arr;
}

// takes a string of "rgb(x,y,z)" & returns it as an RGB object
function rgbToObject(str) {

	var newStr;
	var tempArr = [];
	var obj = {};

	newStr = str.substring(str.indexOf('(')+1,str.indexOf(')'));
	tempArr = newStr.split(',').slice();
	for (var j in tempArr){
		tempArr.push(parseInt(tempArr[j].trim()));
	}

	obj['r'] = tempArr[3];
	obj['g'] = tempArr[4];
	obj['b'] = tempArr[5];

	return obj;
}

// hex to rgb object
function hexToRgb(hex) {
    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
    } : null;
}



</script>

</body>
</html>